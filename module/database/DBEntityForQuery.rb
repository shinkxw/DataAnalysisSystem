#!/usr/bin/env ruby -w
# encoding: GBK
#数据库实体，可执行查询操作，并附带常用指令集
class DBEntityForQuery < DBEntity
  include Enumerable
  #初始化
  def initialize(conn,db_name)
    super(conn,db_name)
    db_init()
  end
  #初始化数据库表信息
  def db_init
    table_arr = get_table_name_arr.map{|tname| [tname.to_sym, DBTableForQuery.new(tname, self)]}
    view_arr = get_view_name_arr.map{|vname| [vname.to_sym, DBTableForQuery.new(vname, self)]}
    @table_hash = Hash[*(table_arr + view_arr).flatten]
  end
  #返回表对象
  def method_missing(method_symbol, *pars)
    table = @table_hash[method_symbol]
    return table if table
    super
  end
  def each;@table_hash.each_value{|table| yield(table)} end
end